<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>PAI TP2 - Alunos</title>
  </head>
  <body>
    <h1>Turmas</h1>

    <table>
      <thead>
        <tr>
          <th>NÃºmero</th>
          <th>Nome</th>
          <th>Nota Final</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="studentsTableBody"></tbody>
    </table>

    <script src="vendors/mustache-4.1.0/mustache.min.js"></script>

    <script src="scripts/entities/class.js"></script>
    <script src="scripts/entities/student.js"></script>
    <script src="scripts/storage.js"></script>
    <script src="scripts/template.js"></script>
    <script src="scripts/main.js"></script>

    <script lang="text/javascript">
      window.onload = async function () {
        await initializeApplication();

        renderPage();
      }

      function renderPage() {
        const studentsTableBody = document.getElementById("studentsTableBody");

        // Remove all list items nodes
        while (studentsTableBody.hasChildNodes()) {
          studentsTableBody.removeChild(studentsTableBody.lastChild);
        }

        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);

        const classId = urlParams.values().next().value;
        const numberClassId = parseInt(classId);
        const schoolClass = window.storage.getClass(numberClassId);

        const data = {
          students: []
        };

        schoolClass.students.forEach((student) => {
          const newStudent = {
            number: student.number,
            name: student.name,
            finalGrade: student.finalGrade,
          };
          data.students.push(newStudent);
        });

        const studentRows = window.template.renderTemplate("studentRows", data);
        studentsTableBody.appendChild(studentRows);
      }
    </script>
  </body>
</html>
